<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CARLsim: Chapter 6: Generating Input</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="CARLsimStyles.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CARLsim
   &#160;<span id="projectnumber">4.0.0-beta</span>
   </div>
   <div id="projectbrief">CARLsim: a GPU-accelerated SNN simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="usergroup0.html"><span>User&#160;Guide</span></a></li>
      <li><a href="usergroup1.html"><span>Tutorial</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ch6_input.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Chapter 6: Generating Input </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ch6s1_generating_spikes">6.1 Generating Spikes</a><ul><li class="level2"><a href="#ch6s1s1_poisson_rate">6.1.1 Generating Poisson Spikes</a><ul><li class="level3"><a href="#ch6s1s1s1">6.1.1.1 The PoissonRate Object</a></li>
<li class="level3"><a href="#ch6s1s1s2">6.1.1.2 Setting Mean Firing Rates</a></li>
<li class="level3"><a href="#ch6s1s1s3">6.1.1.3 Retrieving Mean Firing Rates</a></li>
<li class="level3"><a href="#ch6s1s1s4">6.1.1.4 Integrating PoissonRate with a CARLsim Simulation</a></li>
</ul>
</li>
<li class="level2"><a href="#ch6s1s2_periodic">6.1.2 Periodically Generating Spikes</a></li>
<li class="level2"><a href="#ch6s1s3_from_vector">6.1.3 Generating Spikes from a Vector</a></li>
<li class="level2"><a href="#ch6s1s4_from_file">6.1.4 Generating Spikes from File</a></li>
<li class="level2"><a href="#ch6s1s5_custom">6.1.5 Generating Custom Spikes</a></li>
</ul>
</li>
<li class="level1"><a href="#ch6s2_generating_current">6.2 Generating Current</a></li>
<li class="level1"><a href="#ch6s3_visual_stimulus_toolbox">6.3 Visual Stimulus Toolbox</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="ch6s1_generating_spikes"></a>
6.1 Generating Spikes</h1>
<dl class="section author"><dt>Author</dt><dd>Michael Beyeler</dd></dl>
<h2><a class="anchor" id="ch6s1s1_poisson_rate"></a>
6.1.1 Generating Poisson Spikes</h2>
<h3><a class="anchor" id="ch6s1s1s1"></a>
6.1.1.1 The PoissonRate Object</h3>
<p>The <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> class allows a user create spike trains whose inter-spike interval follows a Poisson process. The object can then be linked to a spike generator group (created via CARLsim::createSpikeGeneratorGroup) by calling CARLsim::setSpikeRate.</p>
<p>The easiest way to initialize a <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> object is via the following: </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> nNeur = 50;                                       <span class="comment">// # neurons</span></div>
<div class="line"><a class="code" href="classPoissonRate.html">PoissonRate</a> poissRate(nNeur);</div>
</div><!-- fragment --><p>This will generate a mean rate vector for 50 neurons. By default, these rates will be allocated on CPU. An optional second argument to the constructor allows allocation on GPU instead (<code>onGPU=true</code>). This allows the minimization of memory transfers when <a class="el" href="namespaceCARLsim.html">CARLsim</a> is run in GPU_MODE: </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> nNeur = 50;                                       <span class="comment">// # neurons</span></div>
<div class="line"><span class="keywordtype">bool</span> onGPU = <span class="keyword">true</span>;                                    <span class="comment">// whether to allocate on GPU (true) or CPU (false)</span></div>
<div class="line"><a class="code" href="classPoissonRate.html">PoissonRate</a> poissRate(nNeur, onGPU);</div>
</div><!-- fragment --><h3><a class="anchor" id="ch6s1s1s2"></a>
6.1.1.2 Setting Mean Firing Rates</h3>
<p>At first, all the rates will be initialized to zero. The user then has several options to assign non-zero rates: </p>
<div class="fragment"><div class="line"><span class="comment">// set all rates to 10 Hz</span></div>
<div class="line">poissRate.setRates(10.0f);</div>
<div class="line"></div>
<div class="line"><span class="comment">// set rates according to some vector</span></div>
<div class="line">std::vector&lt;float&gt; someVector;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> neurId=0; neurId&lt;nNeur; neurId++)</div>
<div class="line">    someVector.push_back(neurId*2.0f);</div>
<div class="line">poissRate.setRates(someVector);</div>
<div class="line"></div>
<div class="line"><span class="comment">// set rate of each neuron</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> neurId=0; neurId&lt;nNeur; neurId++)</div>
<div class="line">    poissRate.setRate(neurId, neurId*2.0f);</div>
</div><!-- fragment --><h3><a class="anchor" id="ch6s1s1s3"></a>
6.1.1.3 Retrieving Mean Firing Rates</h3>
<p>The mean firing rates can then be queried via the following getter functions: </p>
<div class="fragment"><div class="line">std::vector&lt;float&gt; rates = poissRate.getRates();      <span class="comment">// get all rates in a vector</span></div>
<div class="line"><span class="keywordtype">float</span> someRate = poissRate.getRate(17);               <span class="comment">// get rate of neuron with ID=17</span></div>
</div><!-- fragment --><h3><a class="anchor" id="ch6s1s1s4"></a>
6.1.1.4 Integrating PoissonRate with a CARLsim Simulation</h3>
<p>Finally, a <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> object can be linked to a spike generator group (created via CARLsim::createSpikeGeneratorGroup) by calling CARLsim::setSpikeRate. For this to work, the number of neurons for the <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> object must be the same as for the spike generator group. </p>
<div class="fragment"><div class="line">CARLsim sim(<span class="stringliteral">&quot;MyNet&quot;</span>,<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728">GPU_MODE</a>,0,42);                   <span class="comment">// run simulation in GPU_MODE</span></div>
<div class="line"><span class="comment">// configure network</span></div>
<div class="line"><span class="keywordtype">int</span> nNeur = 10;                                       <span class="comment">// # neurons in group</span></div>
<div class="line"><span class="keywordtype">int</span> g0 = sim.createSpikeGeneratorGroup(<span class="stringliteral">&quot;grpPoiss&quot;</span>, nNeur, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line">sim.setupNetwork();</div>
<div class="line"></div>
<div class="line"><span class="comment">// setup PoissonRate object</span></div>
<div class="line"><a class="code" href="classPoissonRate.html">PoissonRate</a> poissRate(nNeur, <span class="keyword">true</span>);                   <span class="comment">// allocate on GPU for minimal memory copies</span></div>
<div class="line">poissRate.setRates(13.0f);                            <span class="comment">// set all rates to 13 Hz</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// apply to neuron group g0</span></div>
<div class="line"><span class="comment">// nNeur of PoissonRate must match that of createSpikeGeneratorGroup</span></div>
<div class="line">sim.setSpikeRate(g0, &amp;poissRate);</div>
<div class="line"></div>
<div class="line"><span class="comment">// run network</span></div>
<div class="line"><span class="comment">// g0 will now produce Poisson spike trains with mean rate = 13 Hz</span></div>
<div class="line">sim.runNetwork(1,0);</div>
<div class="line"></div>
<div class="line"><span class="comment">// note that spike rates will still be 13 Hz in subsequent runs ...</span></div>
<div class="line">sim.runNetwork(0,500);</div>
<div class="line"></div>
<div class="line"><span class="comment">// ... until you reset the rates</span></div>
<div class="line">poissRate.setRates(0.0f);</div>
<div class="line">sim.setSpikeRate(g0, &amp;poissRate);                     <span class="comment">// need to call setSpikeRate again</span></div>
<div class="line">sim.runNetwork(0,10);                                 <span class="comment">// no more input spikes</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This method can only be applied to <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> groups. </dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>CARLsim::setSpikeRate will <em>not</em> take over ownership of <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a>. In other words, if you allocate the <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> object on the heap, you are responsible for correctly deallocating it. </dd>
<dd>
Make sure to reset spike rate after use (i.e., for the next call to CARLsim::runNetwork), otherwise the rate will keep getting applied to the group. </dd>
<dd>
You cannot use the same <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> object for multiple spikeGenerators. Each <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> objects can only be used for a single <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> object at a time.</dd></dl>
<h2><a class="anchor" id="ch6s1s2_periodic"></a>
6.1.2 Periodically Generating Spikes</h2>
<p>A <a class="el" href="classPeriodicSpikeGenerator.html" title="a periodic SpikeGenerator (constant ISI) creating spikes at a certain rate ">PeriodicSpikeGenerator</a> can be used to generate spike trains of a given mean firing rate with a constant inter-spike-interval (ISI) that is equal to 1/rate.</p>
<p>A <a class="el" href="classPeriodicSpikeGenerator.html" title="a periodic SpikeGenerator (constant ISI) creating spikes at a certain rate ">PeriodicSpikeGenerator</a> is instantiated as follows: </p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> rate = 10.0f;</div>
<div class="line"><span class="keywordtype">bool</span> spikeAtZero = <span class="keyword">false</span>;</div>
<div class="line"><a class="code" href="classPeriodicSpikeGenerator.html">PeriodicSpikeGenerator</a> PSG(rate, spikeAtZero);</div>
</div><!-- fragment --><p> Here, the firing rate of the Spike Generator is 10 Hz (<code>rate</code>), which leads to an ISI of 100ms. Thus, the <a class="el" href="classPeriodicSpikeGenerator.html" title="a periodic SpikeGenerator (constant ISI) creating spikes at a certain rate ">PeriodicSpikeGenerator</a> will schedule spike for each neuron in the group it is applied to at t=100ms, t=200ms, t=300ms, etc. If the flag <code>spikeAtZero</code> is set to true, an additional spike will be scheduled at t=0.</p>
<p>In order for a <a class="el" href="classPeriodicSpikeGenerator.html" title="a periodic SpikeGenerator (constant ISI) creating spikes at a certain rate ">PeriodicSpikeGenerator</a> to be associated with a <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> group, CARLsim::setSpikeGenerator must be called on the group in <a class="el" href="carlsim__datastructures_8h.html#a8d0d24f2706656b1102c5e3624df65b2ac7fa385000dcb927a21b44bce4fbfca9" title="configuration state, where the neural network is configured ">CONFIG_STATE</a>: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="carlsim_8h.html">carlsim.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// configure network</span></div>
<div class="line">CARLsim sim(<span class="stringliteral">&quot;PSG example&quot;</span>,<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a>,<a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>);</div>
<div class="line"><span class="keywordtype">int</span> g0 = sim.createSpikeGeneratorGroup(<span class="stringliteral">&quot;input&quot;</span>, 10, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="comment">// etc.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// create periodic spike gen</span></div>
<div class="line"><a class="code" href="classPeriodicSpikeGenerator.html">PeriodicSpikeGenerator</a> PSG(50.0f, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// associate group g0 with PSG</span></div>
<div class="line">sim.setSpikeGenerator(g0, &amp;PSG);</div>
<div class="line"></div>
<div class="line">sim.setupNetwork();</div>
<div class="line"><span class="comment">// etc.</span></div>
</div><!-- fragment --><dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h2><a class="anchor" id="ch6s1s3_from_vector"></a>
6.1.3 Generating Spikes from a Vector</h2>
<p>A <a class="el" href="classSpikeGeneratorFromVector.html" title="a SpikeGenerator that schedules spikes from a vector of spike times ">SpikeGeneratorFromVector</a> can be used to schedule exact spike times (ms) from a vector. Note that currently the only option is to specify a single vector of spike times, which will apply to all neurons in the group. In the future, it should be possible to specify a vector of spike times for each neuron in the group.</p>
<p>A <a class="el" href="classSpikeGeneratorFromVector.html" title="a SpikeGenerator that schedules spikes from a vector of spike times ">SpikeGeneratorFromVector</a> is instantiated as follows: </p>
<div class="fragment"><div class="line">std::vector&lt;int&gt; spikeTimes = {2, 14, 100, 1353};</div>
<div class="line"><a class="code" href="classSpikeGeneratorFromVector.html">SpikeGeneratorFromVector</a> SGV(spikeTimes);</div>
</div><!-- fragment --><p>In order for a <a class="el" href="classSpikeGeneratorFromVector.html" title="a SpikeGenerator that schedules spikes from a vector of spike times ">SpikeGeneratorFromVector</a> to be associated with a <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> group, CARLsim::setSpikeGenerator must be called on the group in <a class="el" href="carlsim__datastructures_8h.html#a8d0d24f2706656b1102c5e3624df65b2ac7fa385000dcb927a21b44bce4fbfca9" title="configuration state, where the neural network is configured ">CONFIG_STATE</a>: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="carlsim_8h.html">carlsim.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// configure network</span></div>
<div class="line">CARLsim sim(<span class="stringliteral">&quot;SGV example&quot;</span>,<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a>,<a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>);</div>
<div class="line"><span class="keywordtype">int</span> g0 = sim.createSpikeGeneratorGroup(<span class="stringliteral">&quot;input&quot;</span>, 10, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="comment">// etc.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// create spike gen from vector</span></div>
<div class="line">std::vector&lt;int&gt; spikeTimes = {2, 14, 100, 1353};</div>
<div class="line"><a class="code" href="classSpikeGeneratorFromVector.html">SpikeGeneratorFromVector</a> SGV(spikeTimes);</div>
<div class="line"></div>
<div class="line"><span class="comment">// associate group g0 with PSG</span></div>
<div class="line">sim.setSpikeGenerator(g0, &amp;SGV);</div>
<div class="line"></div>
<div class="line">sim.setupNetwork();</div>
<div class="line"><span class="comment">// etc.</span></div>
</div><!-- fragment --><dl class="section attention"><dt>Attention</dt><dd>Currently the vector of spike times will apply to all neurons in the group. However, in a near-future release it should be possible to specify a vector of spike times for each neuron in the group.</dd></dl>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h2><a class="anchor" id="ch6s1s4_from_file"></a>
6.1.4 Generating Spikes from File</h2>
<p>A <a class="el" href="classSpikeGeneratorFromFile.html" title="a SpikeGeneratorFromFile schedules spikes from a spike file binary ">SpikeGeneratorFromFile</a> can be used to schedule exact spike times (ms) from a spike file binary that was previously created with a <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a>. This makes it possible to repeatedely apply pre-recorded spike times to the same network (or a different network with the same amount of neurons in the associated group).</p>
<p>A <a class="el" href="classSpikeGeneratorFromFile.html" title="a SpikeGeneratorFromFile schedules spikes from a spike file binary ">SpikeGeneratorFromFile</a> is instantiated as follows: </p>
<div class="fragment"><div class="line"><a class="code" href="classSpikeGeneratorFromFile.html">SpikeGeneratorFromFile</a> SGF(<span class="stringliteral">&quot;results/spk_input.dat&quot;</span>);</div>
</div><!-- fragment --><p> where the string "results/spk_input.dat" points to a spike file previously created with a <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a>.</p>
<p>In order for a <a class="el" href="classSpikeGeneratorFromFile.html" title="a SpikeGeneratorFromFile schedules spikes from a spike file binary ">SpikeGeneratorFromFile</a> to be associated with a <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> group, CARLsim::setSpikeGenerator must be called on the group in <a class="el" href="carlsim__datastructures_8h.html#a8d0d24f2706656b1102c5e3624df65b2ac7fa385000dcb927a21b44bce4fbfca9" title="configuration state, where the neural network is configured ">CONFIG_STATE</a>: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="carlsim_8h.html">carlsim.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// configure network</span></div>
<div class="line">CARLsim sim(<span class="stringliteral">&quot;SGF example&quot;</span>,<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a>,<a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>);</div>
<div class="line"><span class="keywordtype">int</span> g0 = sim.createSpikeGeneratorGroup(<span class="stringliteral">&quot;input&quot;</span>, 10, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="comment">// etc.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// create spike gen from file</span></div>
<div class="line"><a class="code" href="classSpikeGeneratorFromFile.html">SpikeGeneratorFromFile</a> SGF(<span class="stringliteral">&quot;results/spk_input.dat&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// associate group g0 with SGF</span></div>
<div class="line">sim.setSpikeGenerator(g0, &amp;SGF);</div>
<div class="line"></div>
<div class="line">sim.setupNetwork();</div>
<div class="line"><span class="comment">// etc.</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The current implementation might be relatively slow for large networks and long simulations. However, a near-future release will take care of this issue. </dd></dl>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h2><a class="anchor" id="ch6s1s5_custom"></a>
6.1.5 Generating Custom Spikes</h2>
<p>For more fine-grained control over spike generation, individual spike times can be specified per neuron in each group. This is accomplished by using a callback mechanism, which is called at each time step, to specify whether a neuron has fired or not.</p>
<p>In order to specify spike times, a new class is defined that derives from the <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> class: </p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MySpikes : <span class="keyword">public</span> <a class="code" href="classSpikeGenerator.html">SpikeGenerator</a> {</div>
<div class="line">    <span class="comment">// etc.</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The user must then define a <a class="el" href="classSpikeGenerator.html#a356c7b25be9b3ced55d390d2baea3140" title="controls spike generation using a callback mechanism ">SpikeGenerator::nextSpikeTime</a> method. The following is a simple example that generates a spike every 100ms for each neuron in the group. </p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nextSpikeTime(CARLsim* sim, <span class="keywordtype">int</span> grpId, <span class="keywordtype">int</span> nid, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currentTime, </div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lastScheduledSpikeTime) {</div>
<div class="line">        <span class="keywordflow">return</span> (lastScheduledSpikeTime + 100);</div>
<div class="line">}</div>
</div><!-- fragment --><p>In order for a custom <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> to be associated with a <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> group, CARLsim::setSpikeGenerator must be called on the group in <a class="el" href="carlsim__datastructures_8h.html#a8d0d24f2706656b1102c5e3624df65b2ac7fa385000dcb927a21b44bce4fbfca9" title="configuration state, where the neural network is configured ">CONFIG_STATE</a>: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="carlsim_8h.html">carlsim.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// configure network</span></div>
<div class="line">CARLsim sim(<span class="stringliteral">&quot;custom SG example&quot;</span>,<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a>,<a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>);</div>
<div class="line"><span class="keywordtype">int</span> g0 = sim.createSpikeGeneratorGroup(<span class="stringliteral">&quot;input&quot;</span>, 10, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="comment">// etc.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// create custom spike generator</span></div>
<div class="line">MySpikes CSG;</div>
<div class="line"></div>
<div class="line"><span class="comment">// associate group g0 with CSG</span></div>
<div class="line">sim.setSpikeGenerator(g0, &amp;CSG);</div>
<div class="line"></div>
<div class="line">sim.setupNetwork();</div>
<div class="line"><span class="comment">// etc.</span></div>
</div><!-- fragment --><dl class="section since"><dt>Since</dt><dd>v2.0</dd></dl>
<h1><a class="anchor" id="ch6s2_generating_current"></a>
6.2 Generating Current</h1>
<dl class="section author"><dt>Author</dt><dd>Michael Beyeler</dd></dl>
<p>CARLsim::setExternalCurrent can be used to inject currents, specified on a per-neuron basis, into the soma of each neuron in a group, at each timestep of the simulation (every millisecond). For this, a float vector of current amounts (mA) is specified, one element per neuron in the group.</p>
<p>Note that once CARLsim::setExternalCurrent is called, the specified amount of current will be injected every timestep, until the user calls CARLsim::setExternalCurrent again with updated values (e.g., with value zero).</p>
<p>To input different currents into a neuron over time, the idea is to run short periods of CARLsim::runNetwork and subsequently calling CARLsim::setExternalCurrent with updated current values.</p>
<p>For example, the following code snippet injects 5mA for 50ms into the soma of every neuron in the group: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="carlsim_8h.html">carlsim.h</a>&gt;</span></div>
<div class="line">CARLsim sim(<span class="stringliteral">&quot;Current Injection&quot;</span>,<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a>,<a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>);</div>
<div class="line"><span class="keywordtype">int</span> g0 = sim.createGroup(<span class="stringliteral">&quot;input&quot;</span>, 10, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="comment">// etc.</span></div>
<div class="line"></div>
<div class="line">sim.setupNetwork();</div>
<div class="line"></div>
<div class="line">std::vector&lt;float&gt; current(10, 5.0f);</div>
<div class="line">snn.setExternalCurrent(g0, current);</div>
<div class="line">snn.runNetwork(0,50);</div>
</div><!-- fragment --><p>Note that in the case where the same current applies to every neuron, it is sufficient to pass a single float value: </p>
<div class="fragment"><div class="line"><span class="comment">// the following statement ...</span></div>
<div class="line">sim.setExternalCurrent(g0, 5.0f);</div>
<div class="line"><span class="comment">// ... is equivalent to:</span></div>
<div class="line">std::vector&lt;float&gt; current(10, 5.0f);</div>
<div class="line">sim.setExternalCurrent(g0, current);</div>
</div><!-- fragment --><p>After stimulation, the idea is to reset the external current to zero: </p>
<div class="fragment"><div class="line"><span class="comment">// apply current for 10ms</span></div>
<div class="line">sim.setExternalCurrent(g0, 5.0f);</div>
<div class="line">sim.runNetwork(0,10);</div>
<div class="line"></div>
<div class="line"><span class="comment">// then reset current</span></div>
<div class="line">sim.setExternalCurrent(g0, 0.0f);</div>
<div class="line">sim.runNetwork(1,0);</div>
<div class="line"><span class="comment">// etc.</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This method cannot be applied to <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> groups. </dd>
<dd>
If all neurons in the group should receive the same amount of current, you can use the convenience function setExternalCurrent(int grpId, float current).</dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>Make sure to reset current after use (i.e., for the next call to runNetwork), otherwise the current will keep getting applied to the group.</dd></dl>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h1><a class="anchor" id="ch6s3_visual_stimulus_toolbox"></a>
6.3 Visual Stimulus Toolbox</h1>
<dl class="section author"><dt>Author</dt><dd>Michael Beyeler</dd></dl>
<p>The <a class="el" href="classVisualStimulus.html" title="Class to integrate CARLsim with a stimulus created using VisualStimulus.m Version: 4/11/14 Author: Mi...">VisualStimulus</a> utility consists of a MATLAB Toolbox that allows for the generation of 2D visual stimuli such as sinusoidal gratings, plaids, and random dot fields as well as some C++ <a class="el" href="namespaceCARLsim.html">CARLsim</a> plug-in code. The MATLAB class allows to mix-and-match stimuli of different types, on a frame-by-frame basis. Stimuli can also be confined to visual aperture and combined with noise. Frames can then be dumped to a binary file, so that they can be reloaded later on.</p>
<p>Usage example: The following MATLAB code snippet creates a 32x32 pixel grayscale stimulus that consists of a sinusoidal grating (first ten frames), followed by a blank frame (delay period), followed by a plaid stimulus (next ten frames), confined to a circular aperture. The resulting stimulus is first plotted in figure axes, then recorded to AVI, and finally stored as a binary with a default name depending on the stimulus type, such as "inpGratingPlaid_gray_32x32x21.dat". </p>
<div class="fragment"><div class="line">&gt;&gt; VS = <a class="code" href="classVisualStimulus.html">VisualStimulus</a>(32,32);</div>
<div class="line">&gt;&gt; VS.addSinGrating; % add 10 frames of a sinusoidal grating</div>
<div class="line">&gt;&gt; VS.addBlankFrames; % blank frame <span class="keywordflow">for</span> delay period</div>
<div class="line">&gt;&gt; VS.addPlaid; % add 10 frames of a plaid stimulus</div>
<div class="line">&gt;&gt; VS.addApertureToExistingFrames; % confine frames to aperture</div>
<div class="line">&gt;&gt; VS.displayFrames; % plot them!</div>
<div class="line">&gt;&gt; VS.recordMovie; % record an AVI movie</div>
<div class="line">&gt;&gt; VS.saveToFile; % store the created stimulus to binary</div>
</div><!-- fragment --><p><a class="el" href="namespaceCARLsim.html">CARLsim</a> provides plug-in code to interface the generated binary files with <a class="el" href="classSpikeGenerator.html">SpikeGenerator</a> groups. This allows the user to create sophisticated visual stimuli in MATLAB, and interface them to a spiking network on a frame-by-frame basis. The class <a class="el" href="classVisualStimulus.html" title="Class to integrate CARLsim with a stimulus created using VisualStimulus.m Version: 4/11/14 Author: Mi...">VisualStimulus</a> reads frames from binary, and returns either the raw character array or a <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> object with the same size as number of pixels in a stimulus frame.</p>
<p>A <a class="el" href="classVisualStimulus.html" title="Class to integrate CARLsim with a stimulus created using VisualStimulus.m Version: 4/11/14 Author: Mi...">VisualStimulus</a> is instantiated as follows: </p>
<div class="fragment"><div class="line"><a class="code" href="classVisualStimulus.html">VisualStimulus</a> VS(<span class="stringliteral">&quot;inpGratingPlaid_gray_32x32x21.dat&quot;</span>);</div>
<div class="line"><span class="keywordtype">int</span> videoLength = VS.getStimulusLength();</div>
</div><!-- fragment --><p> where the string "inpGratingPlaid_gray_32x32x21.dat" references the created file mentioned above. The number of frames can be retrieved with VisualStimulus::getStimulusLength.</p>
<p>It is then straightforward to interface the recorded stimulus with a <a class="el" href="namespaceCARLsim.html">CARLsim</a> simulation by making use of VisualStimulus::readFrame, which, whenever called, reads the <em>next</em> unread frame and returns it either as a raw character array or as a <a class="el" href="classPoissonRate.html" title="Class for generating Poisson spike trains. ">PoissonRate</a> object. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="carlsim_8h.html">carlsim.h</a>&gt;</span></div>
<div class="line">CARLsim sim(<span class="stringliteral">&quot;VisualStimulus Example&quot;</span>,<a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a729ca642c452f8a7c53df4a48f240537">CPU_MODE</a>,<a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>);</div>
<div class="line"><span class="keywordtype">int</span> g0 = sim.createSpikeGeneratorGroup(<span class="stringliteral">&quot;VSinput&quot;</span>, <a class="code" href="structGrid3D.html">Grid3D</a>(32,32,1), <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="comment">// etc.</span></div>
<div class="line">sim.setupNetwork();</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;videoLength; i++) {</div>
<div class="line">    <a class="code" href="classPoissonRate.html">PoissonRate</a> * rates = VS.readFrame(50.0f); <span class="comment">// grayscale value 255 will be mapped to 50 Hz</span></div>
<div class="line">    sim.setSpikeRate(g0, rates); <span class="comment">// for this to work, there must be 32x32=1024 neurons in g0</span></div>
<div class="line">    sim.runNetwork(1,0); <span class="comment">// run the network</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The following figures shows a number of different stimulus frames created with the MATLAB Visual Stimulus toolbox. The Toolbox provides methods to compose stimuli made of sinusoidal gratings, bars, dots, noise, and custom frames. Apertures can be rectangular or circular. Noise can be white, Gaussian, Poissonian, salt &amp; pepper, or speckle. Random dots can exhibit translatory motion, rotations, expansions, contractions, and mixtures of those types.</p>
<div class="image">
<img src="6_visualstimulus.jpg" alt="6_visualstimulus.jpg"/>
<div class="caption">
VisualStimulus Toolbox examples: sinusoidal gratings, plaids, random dot fields, confined to apertures, with added noise.</div></div>
 <dl class="section note"><dt>Note</dt><dd>Currently only grayscale stimuli are supported. However, a near-future release will add support for RGB stimuli. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Apr 12 2018 18:34:26 for CARLsim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
