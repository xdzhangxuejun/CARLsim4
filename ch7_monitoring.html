<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CARLsim: Chapter 7: Monitoring</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="CARLsimStyles.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CARLsim
   &#160;<span id="projectnumber">4.0.0-beta</span>
   </div>
   <div id="projectbrief">CARLsim: a GPU-accelerated SNN simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="usergroup0.html"><span>User&#160;Guide</span></a></li>
      <li><a href="usergroup1.html"><span>Tutorial</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ch7_monitoring.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Chapter 7: Monitoring </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ch7s1_spike_monitor">7.1 Spike Monitor</a><ul><li class="level2"><a href="#ch7s1s1_setting_up">7.1.1 Setting Up a Spike Monitor</a></li>
<li class="level2"><a href="#ch7s1s2_spike_monitor_object">7.1.2 The SpikeMonitor Object</a><ul><li class="level3"><a href="#ch7s1s2s1_start_stop_recording">7.1.2.1 Start and Stop Recording</a></li>
<li class="level3"><a href="#ch7s1s2s3_spike_data">7.1.2.2 Spike Data</a></li>
<li class="level3"><a href="#ch7s1s2s3_spike_metrics">7.1.2.3 Spike Metrics</a></li>
<li class="level3"><a href="#ch7s1s2s4_spike_statistics">7.1.2.4 Spike Statistics</a></li>
</ul>
</li>
<li class="level2"><a href="#ch7s1s3_redirecting_file_streams">7.1.3 Redirecting File Streams</a></li>
</ul>
</li>
<li class="level1"><a href="#ch7s2_connection_monitor">7.2 Connection Monitor</a><ul><li class="level2"><a href="#ch7s2s1_setting_up">7.2.1 Setting up a Connection Monitor</a></li>
<li class="level2"><a href="#ch7s2s2_connection_monitor_object">7.2.2 The Connection Monitor Object</a><ul><li class="level3"><a href="#ch7s2s2s1_taking_snapshots">7.2.2.1 Taking Weight Snapshots</a></li>
<li class="level3"><a href="#ch7s2s2s2_printing_weights">7.2.2.2 Printing Weights</a></li>
<li class="level3"><a href="#ch7s2s2s3_weight_metrics">7.2.2.3 Weight Metrics</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="ch7s1_spike_monitor"></a>
7.1 Spike Monitor</h1>
<dl class="section author"><dt>Author</dt><dd>Michael Beyeler </dd>
<dd>
Kristofor D. Carlson</dd></dl>
<p>SpikeMonitors can be used to record output spikes for different neuronal groups.</p>
<p><a class="el" href="namespaceCARLsim.html">CARLsim</a> supports two different recording mechanisms: Recording to a spike file (binary) and recording to a <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a> object. The former is useful for off-line analysis of activity (e.g., using <a class="el" href="ch9_matlab_oat.html">Chapter 9: MATLAB Offline Analysis Toolbox (OAT)</a>). The latter is useful to calculate different spike metrics and statistics on-line, such as mean firing rate and standard deviation, or the number of neurons whose firing rate lies in a certain interval.</p>
<h2><a class="anchor" id="ch7s1s1_setting_up"></a>
7.1.1 Setting Up a Spike Monitor</h2>
<p>The easiest way to start recording the spikes of a group <code>g0</code> to file is to call the following function in <a class="el" href="namespaceCARLsim.html">CARLsim</a> state <a class="el" href="carlsim__datastructures_8h.html#a8d0d24f2706656b1102c5e3624df65b2ac7fa385000dcb927a21b44bce4fbfca9" title="configuration state, where the neural network is configured ">CONFIG_STATE</a> or <a class="el" href="carlsim__datastructures_8h.html#a8d0d24f2706656b1102c5e3624df65b2a033f2f21470e4f79d5dc459619a6980c" title="setup state, where the neural network is prepared for execution and monitors are set ...">SETUP_STATE</a>: </p>
<div class="fragment"><div class="line">sim.setSpikeMonitor(g0,<span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
</div><!-- fragment --><p> This will dump all spikes of the group (in AER format) to a binary, over the timecourse of the entire simulation. The default file name is <code>"results/spk_{grpName}.dat"</code>, where <code>{grpName}</code> is the name that was assigned to the group <code>g0</code> in createGroup or createSpikeGeneratorGroup.</p>
<p>The Offline Analysis Toolbox will automatically look for names created according to this template, so that group or network activity can be plotted right away. If a custom name is used, setSpikeFileAttributes must be called in the Matlab utilities GroupMonitor.m or NetworkMonitor.m</p>
<p>A custom name is passed to the function like this: </p>
<div class="fragment"><div class="line">sim.setSpikeMonitor(g0,<span class="stringliteral">&quot;myDirectory/myFile.ext&quot;</span>);</div>
</div><!-- fragment --><p> However, make sure that the directory <code>myDirectory</code> exists.</p>
<p>If no binary shall be created, use: </p>
<div class="fragment"><div class="line">sim.setSpikeMonitor(g0,<span class="stringliteral">&quot;NULL&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="ch7s1s2_spike_monitor_object"></a>
7.1.2 The SpikeMonitor Object</h2>
<p>A second way to record group activity is to use the <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a> object that is returned by setSpikeMonitor, and query it for spike data, metrics, and statistics. </p>
<div class="fragment"><div class="line"><a class="code" href="classSpikeMonitor.html">SpikeMonitor</a>* spkMon = sim.setSpikeMonitor(g0,<span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
</div><!-- fragment --><dl class="TODO"><dt><b><a class="el" href="TODO.html#_TODO000054">TODO:</a></b></dt><dd>extend</dd></dl>
<h3><a class="anchor" id="ch7s1s2s1_start_stop_recording"></a>
7.1.2.1 Start and Stop Recording</h3>
<p>Spike data will not be recorded until the <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a> member function <a class="el" href="classSpikeMonitor.html#ab91616c118b701c2afd9136393d1f19b" title="Starts a new recording period. ">SpikeMonitor::startRecording</a> is called. Before any metrics can be computed, the user must call <a class="el" href="classSpikeMonitor.html#a25e0e98dd4519eaaa6b258f0dcb91ac7" title="Ends a recording period. ">SpikeMonitor::stopRecording</a>. In general, a new recording period (the time period between startRecording and stopRecording calls) can be started at any point in time, and can last any number of milliseconds. The <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a> has a PersistentMode, which is off by default. When PersistentMode is off, only the last recording period will be considered. When PersistentMode is on, all the recording periods will be considered. By default, PersistentMode can be switched on/off by calling <a class="el" href="classSpikeMonitor.html#a7ac2c997b5281ea2f2bc00cc9706d37c" title="Sets PersistentMode either on (true) or off (false) ">SpikeMonitor::setPersistentData(bool)</a>. The total time over which the metric is calculated can be retrieved by calling <a class="el" href="classSpikeMonitor.html#a9cf20c30ff0efdbc5e3c5194648a7fb3" title="Returns the total recording time (ms) ">SpikeMonitor::getRecordingTotalTime()</a>.</p>
<p>The following code starts recording spikes for the first second of the simulation then stops recording the spikes. The next second of simulation time is not recorded:</p>
<div class="fragment"><div class="line"><span class="comment">// start recording spikes associated with spkMon object</span></div>
<div class="line">spkMon-&gt;<a class="code" href="classSpikeMonitor.html#ab91616c118b701c2afd9136393d1f19b">startRecording</a>();</div>
<div class="line"><span class="comment">// run the network for one second</span></div>
<div class="line">sim.ruNetwork(1,0,0);</div>
<div class="line"><span class="comment">// stop recording the spike data</span></div>
<div class="line">spkMon-&gt;<a class="code" href="classSpikeMonitor.html#a25e0e98dd4519eaaa6b258f0dcb91ac7">stopRecording</a>();</div>
<div class="line"><span class="comment">// now run the network for two seconds</span></div>
<div class="line">sim.runNetwork(1,0,0);</div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>running a <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a> in PersistentMode could use a lot of memory if your SNNs are large and/or your simulations are for long durations. You have been warned!</dd></dl>
<h3><a class="anchor" id="ch7s1s2s3_spike_data"></a>
7.1.2.2 Spike Data</h3>
<p>There are two different modes that define what information is collected exactly, AER and COUNT mode.</p>
<p>AER mode: AER mode will collect the exact spike times of all neurons in the group and store them in a 2D spike spike vector. The first dimension of the vector is neuron id, the second dimension is spike times. Each element spkVector[i] is thus a vector of all spike times for the i-th neuron in the group. This mode is activated by default.</p>
<dl class="section warning"><dt>Warning</dt><dd>Because of the sheer amount of information, it is unwise to run this mode for extended periods of time.</dd>
<dd>
Recording in this mode may significantly slow down your simulation!</dd></dl>
<p>COUNT mode: SpikeCount mode will only collect spike count information, such as the number of spikes per neuron. This mode cannot retrieve exact spike times. Thus it is not possible to calculate some of the more elaborate metrics, such as spike-time correlations.</p>
<h3><a class="anchor" id="ch7s1s2s3_spike_metrics"></a>
7.1.2.3 Spike Metrics</h3>
<p><a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a> objects come with a number of useful metrics that allows the user to query <a class="el" href="namespaceCARLsim.html">CARLsim</a> simulations programmatically. Users can get the total of number of spikes for the entire group using <a class="el" href="classSpikeMonitor.html#af6c333e6cefff92d0e354eca70625cdc" title="Returns the total number of spikes in the group. ">SpikeMonitor::getPopNumSpikes</a> or the number of spikes per neuron in the group using <a class="el" href="classSpikeMonitor.html#a005a2f884f6260054483d4fa6ed6ddbb" title="returns the total number of spikes of a specific neuron in the group ">SpikeMonitor::getNeuronNumSpikes</a>. To get the maximum or minimum average firing rate of the group, <a class="el" href="classSpikeMonitor.html#ab245e956a782d7d5fc8dc4257d94ecfa" title="returns the largest neuronal mean firing rate in the group ">SpikeMonitor::getMaxFiringRate</a> or <a class="el" href="classSpikeMonitor.html#a30bedc8503ea2e68ce042291f25fd0f8" title="returns the smallest neuronal mean firing rate in the group ">SpikeMonitor::getMinFiringRate</a> can be used. An entire vector of firing rates is available using the function call <a class="el" href="classSpikeMonitor.html#a0fc20fcc5876030d796debd148ae7cee" title="Returns the average firing rate of all the neurons in the group as a vector of floats. ">SpikeMonitor::getAllFiringRates</a>. Additionally, <a class="el" href="classSpikeMonitor.html#ac0d8bd3f92fa0eae87b37f9245e0e13a" title="Returns all the neuronal mean firing rates in ascending order. ">SpikeMonitor::getAllFiringRatesSorted</a> returns the vector of firing rates for every neuron sorted. Another useful function is <a class="el" href="classSpikeMonitor.html#a81857cacf011acddd1791775c34ae4fb" title="Returns the number of neurons that fall within this particular min/max range (inclusive). ">SpikeMonitor::getNumNeuronsWithFiringRate</a> which allows users to find out how many neurons had an average firing rate within a specific user-specified range. These metrics become particularly useful when we begin to tune SNNs as we will see in <a class="el" href="ch10_ecj.html">Chapter 10: ECJ</a> and <a class="el" href="ch12_advanced_topics.html#ch12s3_online_weight_tuning">12.3 On-Line Weight Tuning</a>.</p>
<p>Users may want to get the AER 2D spike vector described in AER mode to do their own metrics or statistics, to do this, they can call <a class="el" href="classSpikeMonitor.html#a64ccdac1d5dacee8b6e45e8a2a9fc40b" title="returns the 2D spike vector ">SpikeMonitor::getSpikeVector2D</a>. Users can manually clear the spike data stored in <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a> objects by calling <a class="el" href="classSpikeMonitor.html#ac8bb3912a3ce86b15842e79d0b421204" title="Truncates the 2D spike vector. ">SpikeMonitor::clear()</a>. If PersistentMode is off this function is automatically called at the beginning of the <a class="el" href="classSpikeMonitor.html#ab91616c118b701c2afd9136393d1f19b" title="Starts a new recording period. ">SpikeMonitor::startRecording</a> function call. Users can also print all the spiking informationin the group in legible format to the console with the <a class="el" href="classSpikeMonitor.html#aa1bdcf4ac22267e52bcb8c3cba660c84" title="prints the 2D spike vector. ">SpikeMonitor::print</a> call with an option for including the list of spike times for each neuron.</p>
<p>Below is an example of a user printing data generated during a simulation. After that, the average firing rates for every neuron are output to a vector.</p>
<div class="fragment"><div class="line"><span class="comment">// print a summary of the spike information</span></div>
<div class="line">spikeMon-&gt;print();</div>
<div class="line"><span class="comment">// get the average firing rate of each of the neurons in group excGrpId</span></div>
<div class="line">vector&lt;float&gt; excFRs = spikeMon-&gt;getAllFiringRates();</div>
</div><!-- fragment --><h3><a class="anchor" id="ch7s1s2s4_spike_statistics"></a>
7.1.2.4 Spike Statistics</h3>
<p>The average firing rate of the group as whole can be found using <a class="el" href="classSpikeMonitor.html#ae62d623e8edfc6b05309256c1d825bbd" title="Returns the mean firing rate of the entire neuronal population. ">SpikeMonitor::getPopMeanFiringRate</a> and the standard deviation can be calculated using <a class="el" href="classSpikeMonitor.html#ad0c4b32bb5cc0c7a8d95ed6023a2695f" title="Returns the standard deviation of firing rates in the entire neuronal population. ...">SpikeMonitor::getPopStdFiringRate</a>. A useful metric in characterizing neural activity can be found with <a class="el" href="classSpikeMonitor.html#ad8dc4f8eb304b0bcbeaf80076f892b72" title="returns the percentage of total neurons in that are in the range specified by the user...">SpikeMonitor::getPercentNeuronsWithFiringRate</a> which returns the percentage of neurons found within a user-defined range. Code for this function is shown below.</p>
<div class="fragment"><div class="line"><span class="comment">// return the percent of neurons with firing rates from 0 to 5 Hz</span></div>
<div class="line">spikeMon-&gt;getPercentNeuronsWithFiringRate(0.0,5.0);</div>
</div><!-- fragment --><p>There are currently plans to include functions that calculate more in-depth statistics related to spike correlations and information theoretic measures in future <a class="el" href="namespaceCARLsim.html">CARLsim</a> versions.</p>
<h2><a class="anchor" id="ch7s1s3_redirecting_file_streams"></a>
7.1.3 Redirecting File Streams</h2>
<p>Using SpikeMonitor::setSpikeFile it is possible to redirect the file streams over the timecourse of a simulation, without having to recompile the network. Say, a simulation consists of three phases: 1) an initial phase, 2) a training phase, and 3) a testing phase. In such a scenario it might be desirable to store the spikes in different files, or, maybe in some phases, not record spikes at all. This can be achieved with ease using the following code snippet: </p>
<div class="fragment"><div class="line"><span class="comment">// initial phase (don&#39;t record to file)</span></div>
<div class="line"><a class="code" href="classSpikeMonitor.html">SpikeMonitor</a>* spkMon = sim.setSpikeMonitor(g0, <span class="stringliteral">&quot;NULL&quot;</span>);</div>
<div class="line">sim.runNetwork(10,0);</div>
<div class="line"></div>
<div class="line"><span class="comment">// training phase (record to file)</span></div>
<div class="line">spkMon-&gt;<a class="code" href="classSpikeMonitor.html#a11168f8252e1416f1706b5f7cae0be1e">setLogFile</a>(<span class="stringliteral">&quot;training.dat&quot;</span>);</div>
<div class="line">sim.runNetwork(10,0);</div>
<div class="line"></div>
<div class="line"><span class="comment">// testing phase (record to different spike file)</span></div>
<div class="line">spkMon-&gt;<a class="code" href="classSpikeMonitor.html#a11168f8252e1416f1706b5f7cae0be1e">setLogFile</a>(<span class="stringliteral">&quot;testing.dat&quot;</span>);</div>
<div class="line">sim.runNetwork(10,0);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Instead of calling <a class="el" href="classSpikeMonitor.html#a11168f8252e1416f1706b5f7cae0be1e" title="Sets the name of the spike file binary. ">SpikeMonitor::setLogFile</a>, you can also call CARLsim::setSpikeMonitor again on the same group, which has the same effect.</dd></dl>
<h1><a class="anchor" id="ch7s2_connection_monitor"></a>
7.2 Connection Monitor</h1>
<dl class="section author"><dt>Author</dt><dd>Michael Beyeler</dd></dl>
<p>ConnectionMonitors can be used to record synaptic weights from a specific connection. Instantaneous recordings of a 2D weight matrix ("snapshots") can be taken either programmatically or automatically every second.</p>
<p><a class="el" href="namespaceCARLsim.html">CARLsim</a> supports two different recording mechanisms: Recording to a weight file (binary) and recording to a <a class="el" href="classConnectionMonitor.html" title="Class ConnectionMonitor. ">ConnectionMonitor</a> object. The former is useful for off-line analysis of synaptic weights (e.g., using <a class="el" href="ch9_matlab_oat.html">Chapter 9: MATLAB Offline Analysis Toolbox (OAT)</a>). The latter is useful to calculate different weight metrics and statistics on-line, such as the percentage of weight values that fall in a certain weight range, or the number of weights that have been changed since the last snapshot.</p>
<h2><a class="anchor" id="ch7s2s1_setting_up"></a>
7.2.1 Setting up a Connection Monitor</h2>
<p>The easiest way to start recording weights of a connection between pre-synaptic group <code>grpIdPre</code> and <code>grpIdPost</code> is to call the following function in <a class="el" href="namespaceCARLsim.html">CARLsim</a> state <a class="el" href="carlsim__datastructures_8h.html#a8d0d24f2706656b1102c5e3624df65b2ac7fa385000dcb927a21b44bce4fbfca9" title="configuration state, where the neural network is configured ">CONFIG_STATE</a> or <a class="el" href="carlsim__datastructures_8h.html#a8d0d24f2706656b1102c5e3624df65b2a033f2f21470e4f79d5dc459619a6980c" title="setup state, where the neural network is prepared for execution and monitors are set ...">SETUP_STATE</a>: </p>
<div class="fragment"><div class="line">sim.setConnectionMonitor(grpIdPre,grpIdPost,<span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
</div><!-- fragment --><p> This will take a snapshot of the 2D weight matrix every 1000 ms and dump the data to file. The default file name will be "results/conn_{name of pre-group}_{name of post-group}.dat". The first snapshot will be taken at t=0ms, the next one at t=1000ms, etc., until the end of the simulation is reached.</p>
<p>It is also possible to specify a custom file name instead of using the "DEFAULT" name. Alternatively, the user may suppress creation of the binary file by using file string "NULL" instead.</p>
<p>Periodic storing can be disabled by calling <a class="el" href="classConnectionMonitor.html#a90d83641a405b71b3652c01fb3ee5f0f" title="Sets the time interval (seconds) for writing snapshots to file. ">ConnectionMonitor::setUpdateTimeIntervalSec</a> with argument <code>intervalSec=-1</code>.</p>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h2><a class="anchor" id="ch7s2s2_connection_monitor_object"></a>
7.2.2 The Connection Monitor Object</h2>
<p>An additional way to record weights is by quering the <a class="el" href="classConnectionMonitor.html" title="Class ConnectionMonitor. ">ConnectionMonitor</a> object that is returned by CARLsim::setConnectionMonitor for connection data: </p>
<div class="fragment"><div class="line"><a class="code" href="classConnectionMonitor.html">ConnectionMonitor</a> * CM = sim.setConnectionMonitor(grpIdPre,grpIdPost,<span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
</div><!-- fragment --><p> where <code>grpIdPre</code> and <code>grpIdPost</code> are the IDs of the pre-synaptic and post-synaptic group, respectively.</p>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h3><a class="anchor" id="ch7s2s2s1_taking_snapshots"></a>
7.2.2.1 Taking Weight Snapshots</h3>
<p>Weight snapshots can also be taken programmatically, by quering the <a class="el" href="classConnectionMonitor.html" title="Class ConnectionMonitor. ">ConnectionMonitor</a> object: </p>
<div class="fragment"><div class="line"><a class="code" href="classConnectionMonitor.html">ConnectionMonitor</a> * CM = sim.setConnectionMonitor(grpIdPre,grpIdPost,<span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
<div class="line">std::vector&lt; std::vector&lt;float&gt; &gt; weights = CM-&gt;<a class="code" href="classConnectionMonitor.html#ab64d9ff17fece61e850660bdd4ca00d2">takeSnapshot</a>();</div>
<div class="line">printf(<span class="stringliteral">&quot;The weight from pre-neuron ID 3 to post-neuron ID 7 is: %f\n&quot;</span>,weights[3][7]);</div>
</div><!-- fragment --><p> This will take an instantaneous snapshot of the weights (at the current simulation time) and return it in a 2D weight matrix. The first dimension of the matrix will be of size <a class="el" href="classConnectionMonitor.html#a438060213521c95ad7f38ea9039dfa9c" title="Returns the number of pre-synaptic neurons. ">ConnectionMonitor::getNumNeuronsPre()</a>, and the second dimension of the matrix will be of size <a class="el" href="classConnectionMonitor.html#a7d71d4ec2b08c52054491ec818ad6ed7" title="Returns the number of post-synaptic neurons. ">ConnectionMonitor::getNumNeuronsPost()</a>. Synaptic connections in the matrix that do not exist will have value NAN and can be queried with <code>isnan(wt[i][j])</code>.</p>
<p>Note that every snapshot taken with this method will also be dumped to file. If the user wants the binary file to contain only distinct snapshots as opposed to a periodic ones taken every second, the recording interval can be adjusted as follows: </p>
<div class="fragment"><div class="line"><a class="code" href="classConnectionMonitor.html">ConnectionMonitor</a> * CM = sim.setConnectionMonitor(grpIdPre,grpIdPost,<span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
<div class="line"><span class="comment">// disable periodid storing of snapshots in binary ...</span></div>
<div class="line">CM-&gt;<a class="code" href="classConnectionMonitor.html#a90d83641a405b71b3652c01fb3ee5f0f">setUpdateTimeIntervalSec</a>(-1);</div>
<div class="line"></div>
<div class="line"><span class="comment">// ... and instead take a snapshot yourself and put it in the binary</span></div>
<div class="line">CM-&gt;<a class="code" href="classConnectionMonitor.html#ab64d9ff17fece61e850660bdd4ca00d2">takeSnapshot</a>();</div>
<div class="line"></div>
<div class="line"><span class="comment">// run the network for 10 seconds</span></div>
<div class="line">sim.runNetwork(10,0);</div>
<div class="line"></div>
<div class="line"><span class="comment">// take another snapshot at the end and put it in the binary</span></div>
<div class="line">CM-&gt;<a class="code" href="classConnectionMonitor.html#ab64d9ff17fece61e850660bdd4ca00d2">takeSnapshot</a>();</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Every snapshot taken with this method will also be dumped to file. </dd></dl>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h3><a class="anchor" id="ch7s2s2s2_printing_weights"></a>
7.2.2.2 Printing Weights</h3>
<p>Weights can be printed in two ways: Either as a 2D weight matrix (pre x post) using <a class="el" href="classConnectionMonitor.html#a388f572c62279f839ee138a9afbdeeb5" title="Prints the current weight state as a 2D matrix (pre x post) ">ConnectionMonitor::print</a> or as a sparse list of only existing synapses using <a class="el" href="classConnectionMonitor.html#a71dc2d0a7970622052e156ca863f4216" title="Prints the current weight state as a sparse list of weights. ">ConnectionMonitor::printSparse</a>: </p>
<div class="fragment"><div class="line"><a class="code" href="classConnectionMonitor.html">ConnectionMonitor</a> * CM = sim.setConnectionMonitor(grpIdPre,grpIdPost,<span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
<div class="line">CM-&gt;<a class="code" href="classConnectionMonitor.html#a388f572c62279f839ee138a9afbdeeb5">print</a>(); <span class="comment">// print 2D weight matrix</span></div>
<div class="line">CM-&gt;<a class="code" href="classConnectionMonitor.html#a71dc2d0a7970622052e156ca863f4216">printSparse</a>(); <span class="comment">// print sparse list</span></div>
</div><!-- fragment --><p><a class="el" href="classConnectionMonitor.html#a71dc2d0a7970622052e156ca863f4216" title="Prints the current weight state as a sparse list of weights. ">ConnectionMonitor::printSparse</a> also accepts up to three optional parameters that allow for formatting options. For more information see its code documentation.</p>
<p>For more sophisticated visualization options please refer to <a class="el" href="ch9_matlab_oat.html">Chapter 9: MATLAB Offline Analysis Toolbox (OAT)</a>.</p>
<dl class="section since"><dt>Since</dt><dd>v3.0</dd></dl>
<h3><a class="anchor" id="ch7s2s2s3_weight_metrics"></a>
7.2.2.3 Weight Metrics</h3>
<p>The <a class="el" href="classConnectionMonitor.html" title="Class ConnectionMonitor. ">ConnectionMonitor</a> class provides a number of methods useful to compute a variety of weight metrics and statistics.</p>
<p>Metrics can be calculated either for the current snapshot (e.g., fan-in, fan-out) or by considering differences between the last two snapshots (e.g., number or percentage of weights that changed).</p>
<p>Fan-in is the number of incoming synapses for a specific post-synaptic neuron, and can be calculated with <a class="el" href="classConnectionMonitor.html#a46e73089106a296d8a0b2c4a5066f079" title="Returns the number of incoming synapses for a specific post-synaptic neuron. ">ConnectionMonitor::getFanIn</a>. Alternatively, <a class="el" href="classConnectionMonitor.html#aa1f808f36c992cd6bd10ffe41a3053e8" title="Returns the number of outgoing synapses for a specific pre-synaptic neuron. ">ConnectionMonitor::getFanOut</a> returns the number of outgoing synapses for a specific pre-synaptic neuron.</p>
<p>Weight changes since the last snapshot can be calculated in a number of different ways. The number of weights whose absolute value has changed at least <code>minAbsChanged</code> (inclusive) since the last snapshot was taken can be calculated with <a class="el" href="classConnectionMonitor.html#ad094dca7a9d2ac2c46e89f1035706eba" title="Returns the number of weights that have changed since the last snapshot. ">ConnectionMonitor::getNumWeightsChanged</a>. The same metric can be obtained as a percentage using <a class="el" href="classConnectionMonitor.html#ab8aa0b542059991a270030b6528d92bd" title="Returns the percentage of weights that have changed since the last snapshot. ">ConnectionMonitor::getPercentWeightsChanged</a>.</p>
<p>The absolute sum of weight changes since the last snapshot can be calculated with <a class="el" href="classConnectionMonitor.html#a991b87f83f8f3a210ab97c6090eeaad9" title="Returns the absolute sum of all the weight changes since the last snapshot. ">ConnectionMonitor::getTotalAbsWeightChange</a>. This function might be useful (for example) to run a network with plastic synapses until learning has saturated: </p>
<div class="fragment"><div class="line"><span class="comment">// configure a network with plastic synapses</span></div>
<div class="line"><span class="keywordtype">int</span> g0 = sim.createGroup(<span class="stringliteral">&quot;g0&quot;</span>, 10, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line"><span class="keywordtype">int</span> g1 = sim.createGroup(<span class="stringliteral">&quot;g1&quot;</span>, 10, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line">sim.connect(g0, g1, <span class="stringliteral">&quot;random&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(0.0f,1.0f), 0.1f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1,10), <a class="code" href="structRadiusRF.html">RadiusRF</a>(-1), <a class="code" href="carlsim__definitions_8h.html#a9baa3423c83e97f02e68daccf466ed4d">SYN_PLASTIC</a>);</div>
<div class="line"><span class="comment">// ... etc. ...</span></div>
<div class="line">sim.setupNetwork();</div>
<div class="line"></div>
<div class="line"><span class="comment">// set a Connection Monitor</span></div>
<div class="line"><a class="code" href="classConnectionMonitor.html">ConnectionMonitor</a> * CM = sim.setConnectionMonitor(g0,g1,<span class="stringliteral">&quot;DEFAULT&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// run network until absolute weight change is lower than some threshold value</span></div>
<div class="line"><span class="keywordtype">float</span> threshold = 1e-2f;</div>
<div class="line"><span class="keywordflow">while</span> (CM-&gt;getTotalAbsWeightChanged() &gt; threshold) {</div>
<div class="line">    sim.runNetwork(1,0); <span class="comment">// run for a second</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// learning has saturated: do testing</span></div>
<div class="line"><span class="comment">// etc.</span></div>
</div><!-- fragment --><dl class="section since"><dt>Since</dt><dd>v3.0 </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Apr 12 2018 18:34:26 for CARLsim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
