<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CARLsim: Tutorial 7: Parameter Tuning Interface (PTI)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="CARLsimStyles.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CARLsim
   &#160;<span id="projectnumber">4.0.0-beta</span>
   </div>
   <div id="projectbrief">CARLsim: a GPU-accelerated SNN simulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="usergroup0.html"><span>User&#160;Guide</span></a></li>
      <li><a href="usergroup1.html"><span>Tutorial</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tut7_pti.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 7: Parameter Tuning Interface (PTI) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tut7s1_intro">7.1 Introduction</a></li>
<li class="level1"><a href="#tut7s2_parameter_file">7.2 The ECJ Parameter File</a></li>
<li class="level1"><a href="#tut7s3_experiment_class">7.3 The Experiment Class</a></li>
<li class="level1"><a href="#tut7s4_output_files">7.4 ECJ Output Files</a></li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Kristofor D. Carlson</dd></dl>
<h1><a class="anchor" id="tut7s1_intro"></a>
7.1 Introduction</h1>
<p>In this tutorial we introduce the parameter tuning interface and how to tune the weight ranges of a simple <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality. ">SNN</a> to achieve a particular target firing rate. We will be tuning four parameter values that represent the weight ranges. The layout of the <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality. ">SNN</a> is as follows. We have 10 input excitatory neurons, 10 regular spiking (RS) excitatory neurons that receive this input, and 10 fast spiking (FS) izhikevich neurons that receive input from the excitatory RS neurons. Additionally, the inhibitory group is connected to the RS excitatory group and the RS excitatory group is connected to itself recurrently. There are therefore 4 connection weight ranges to be tuned. The goal of the tuning is make the RS excitatory group have an average firing rate of 10 Hz and make the FS inhibitory group have an average firing rate of 20 Hz.</p>
<p>All the required files are found in the doc/source/tutorial/3_pti directory. The user is encouraged to follow along and experiment with the source code found there.</p>
<p>This tutorial assumes:</p>
<ul>
<li>ECJ version 22 or greater is installed.</li>
<li><a class="el" href="namespaceCARLsim.html">CARLsim</a> 4.0 is installed.</li>
<li>CARLsim4 and ECJ environment variables are configured correctly.</li>
</ul>
<p>The overview of parameter tuning is as follows. ECJ handles all steps of the evolutionary algorithm (EA) except for the fitness evaluation which is done by <a class="el" href="namespaceCARLsim.html">CARLsim</a> through the implementation of an experiment class function called <code>run</code>.</p>
<p>A more in-depth overview of <a class="el" href="namespaceCARLsim.html">CARLsim</a> and ECJ can be found in <a class="el" href="ch10_ecj.html">Chapter 10: ECJ</a>.</p>
<h1><a class="anchor" id="tut7s2_parameter_file"></a>
7.2 The ECJ Parameter File</h1>
<p>This example has an ECJ parameter file named <code>TuneFiringRatesECJExperiment.params</code>. As mentioned in <a class="el" href="ch10_ecj.html">Chapter 10: ECJ</a>, users must first configure this file if they want to parameter tune <a class="el" href="namespaceCARLsim.html">CARLsim</a> programs.</p>
<p>We first specify that we want a maximum number of 50 generations and a population size of 10. This means 10 individuals (each a separate <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality. ">SNN</a>) will be run in parallel by <a class="el" href="namespaceCARLsim.html">CARLsim</a>:</p>
<div class="fragment"><div class="line">generations =        50</div>
<div class="line">pop.subpop.0.size =  10</div>
</div><!-- fragment --><p>There are four parameter values to be tuned so we set:</p>
<div class="fragment"><div class="line">pop.subpop.0.species.genome-size =      4</div>
</div><!-- fragment --><p>We will allow all four weight ranges to be tuned within the same parameter range although each individual parameter can be given it's own range (see <a class="el" href="ch10_ecj.html">Chapter 10: ECJ</a>). The minimum weight value for each weight is then 0.0005 while the maximum value is 0.5 as shown below:</p>
<div class="fragment"><div class="line">pop.subpop.0.species.min-gene =         0.0005</div>
<div class="line">pop.subpop.0.species.max-gene =         0.5</div>
</div><!-- fragment --><p>Finally we must specify the name of the carlsim binary that ECJ should execute every generation to obtain fitness values. This is done below. Notice there is a <code>$</code> before the filename. This indicates that the location of the file is relative to the location of the parameter file.</p>
<div class="fragment"><div class="line">eval.problem.simulationCommand =        $carlsim_tuneFiringRatesECJ</div>
</div><!-- fragment --><p>Of course any of these parameters can be changed. For more information on ECJ parameter file configuration please visit the ECJ <a href="http://cs.gmu.edu/~eclab/projects/ecj/">homepage</a>.</p>
<h1><a class="anchor" id="tut7s3_experiment_class"></a>
7.3 The Experiment Class</h1>
<p>We next discuss the <a class="el" href="namespaceCARLsim.html">CARLsim</a> code found in the experiment class. This code is found in the main_tuneFiringRatesECJ.cpp file. Users should use this tutorial as template for writing their own code. First a specific experiment class must be inherited from the base class and default constructor must be defined.:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>TuneFiringRatesECJExperiment : <span class="keyword">public</span> Experiment {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">TuneFiringRatesECJExperiment() {}</div>
</div><!-- fragment --><p>After that, the user should only be concerned with writing the <code>run</code> member function.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">void run(<span class="keyword">const</span> ParameterInstances &amp;parameters, std::ostream &amp;outputStream)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordtype">int</span> indiNum = parameters.getNumInstances();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> poissonGroup[indiNum];</div>
<div class="line">    <span class="keywordtype">int</span> excGroup[indiNum];</div>
<div class="line">    <span class="keywordtype">int</span> inhGroup[indiNum];</div>
<div class="line">    <a class="code" href="classSpikeMonitor.html">SpikeMonitor</a>* excMonitor[indiNum];</div>
<div class="line">    <a class="code" href="classSpikeMonitor.html">SpikeMonitor</a>* inhMonitor[indiNum];</div>
<div class="line">    <span class="keywordtype">float</span> excHz[indiNum];</div>
<div class="line">    <span class="keywordtype">float</span> inhHz[indiNum];</div>
<div class="line">    <span class="keywordtype">float</span> excError[indiNum];</div>
<div class="line">    <span class="keywordtype">float</span> inhError[indiNum];</div>
<div class="line">    <span class="keywordtype">float</span> fitness[indiNum];</div>
<div class="line">...</div>
</div><!-- fragment --><p>Notice we can use the parameters object to query how many instances/individuals we have defined in the ECJ parameter file. Now that we have that value, we manually create arrays neuron groups of size <code>indiNum</code>. In our case we have defined 10 individuals per generation.</p>
<p>Next we create our <a class="el" href="namespaceCARLsim.html">CARLsim</a> network object and assign the 4 parameter values generated by ECJ to our 10 <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality. ">SNN</a> individuals. We iterate over all 10 individuals and assign them 4 distinct parameters each.</p>
<div class="fragment"><div class="line">CARLsim* <span class="keyword">const</span> network = <span class="keyword">new</span> CARLsim(<span class="stringliteral">&quot;tuneFiringRatesECJ&quot;</span>, <a class="code" href="carlsim__datastructures_8h.html#a625c4eced5cd956404990e73f3950258a0b5ee5e90bb225a562d92e4078ad9728">GPU_MODE</a>, <a class="code" href="carlsim__datastructures_8h.html#a3a04fc42e22f436d2b3809236cb6ec54ab9de27525b1cd54c353f4ed868a6cb26">SILENT</a>);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; parameters.getNumInstances(); i++) {</div>
<div class="line">    poissonGroup[i] = network-&gt;createSpikeGeneratorGroup(<span class="stringliteral">&quot;poisson&quot;</span>, NUM_NEURONS, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line">    excGroup[i] = network-&gt;createGroup(<span class="stringliteral">&quot;exc&quot;</span>, NUM_NEURONS, <a class="code" href="carlsim__definitions_8h.html#a71b1b059a7ff0783d39e22b9b1028d90">EXCITATORY_NEURON</a>);</div>
<div class="line">    inhGroup[i] = network-&gt;createGroup(<span class="stringliteral">&quot;inh&quot;</span>, NUM_NEURONS, <a class="code" href="carlsim__definitions_8h.html#a1f1973192224715d2362de045a5c6387">INHIBITORY_NEURON</a>);</div>
<div class="line"></div>
<div class="line">    network-&gt;setNeuronParameters(excGroup[i], REG_IZH[0], REG_IZH[1], REG_IZH[2], REG_IZH[3]);</div>
<div class="line">    network-&gt;setNeuronParameters(inhGroup[i], FAST_IZH[0], FAST_IZH[1], FAST_IZH[2], FAST_IZH[3]);</div>
<div class="line">    network-&gt;setConductances(<span class="keyword">true</span>,COND_tAMPA,COND_tNMDA,COND_tGABAa,COND_tGABAb);</div>
<div class="line"></div>
<div class="line">    network-&gt;connect(poissonGroup[i], excGroup[i], <span class="stringliteral">&quot;random&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(parameters.getParameter(i,0)), 0.5f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1));</div>
<div class="line">    network-&gt;connect(excGroup[i], excGroup[i], <span class="stringliteral">&quot;random&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(parameters.getParameter(i,1)), 0.5f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1));</div>
<div class="line">    network-&gt;connect(excGroup[i], inhGroup[i], <span class="stringliteral">&quot;random&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(parameters.getParameter(i,2)), 0.5f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1));</div>
<div class="line">    network-&gt;connect(inhGroup[i], excGroup[i], <span class="stringliteral">&quot;random&quot;</span>, <a class="code" href="structRangeWeight.html">RangeWeight</a>(parameters.getParameter(i,3)), 0.5f, <a class="code" href="structRangeDelay.html">RangeDelay</a>(1));</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p>We then setup the SNNs, begin recording their spike data with a <a class="el" href="classSpikeMonitor.html" title="Class SpikeMonitor. ">SpikeMonitor</a>, and run the SNNs.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">network-&gt;setupNetwork();</div>
<div class="line">...</div>
<div class="line">excMonitor[i] = network-&gt;setSpikeMonitor(excGroup[i], <span class="stringliteral">&quot;/dev/null&quot;</span>);</div>
<div class="line">inhMonitor[i] = network-&gt;setSpikeMonitor(inhGroup[i], <span class="stringliteral">&quot;/dev/null&quot;</span>);</div>
<div class="line"></div>
<div class="line">excMonitor[i]-&gt;<a class="code" href="classSpikeMonitor.html#ab91616c118b701c2afd9136393d1f19b">startRecording</a>();</div>
<div class="line">inhMonitor[i]-&gt;<a class="code" href="classSpikeMonitor.html#ab91616c118b701c2afd9136393d1f19b">startRecording</a>();</div>
<div class="line">...</div>
<div class="line">network-&gt;runNetwork(runTime,0);</div>
</div><!-- fragment --><p>Finally we stop recording, get the average firing rate of each group and compute a fitness function which is output to ECJ using standard Linux streams.</p>
<div class="fragment"><div class="line">excMonitor[i]-&gt;<a class="code" href="classSpikeMonitor.html#a25e0e98dd4519eaaa6b258f0dcb91ac7">stopRecording</a>();</div>
<div class="line">inhMonitor[i]-&gt;<a class="code" href="classSpikeMonitor.html#a25e0e98dd4519eaaa6b258f0dcb91ac7">stopRecording</a>();</div>
<div class="line"></div>
<div class="line">excHz[i] = excMonitor[i]-&gt;<a class="code" href="classSpikeMonitor.html#ae62d623e8edfc6b05309256c1d825bbd">getPopMeanFiringRate</a>();</div>
<div class="line">inhHz[i] = inhMonitor[i]-&gt;<a class="code" href="classSpikeMonitor.html#ae62d623e8edfc6b05309256c1d825bbd">getPopMeanFiringRate</a>();</div>
<div class="line"></div>
<div class="line">excError[i] = fabs(excHz[i] - EXC_TARGET_HZ);</div>
<div class="line">inhError[i] = fabs(inhHz[i] - INH_TARGET_HZ);</div>
<div class="line"></div>
<div class="line">fitness[i] = 1/(excError[i] + inhError[i]);</div>
<div class="line">outputStream &lt;&lt; fitness[i] &lt;&lt; endl;</div>
</div><!-- fragment --><p>To compile and run the tuning framework we simply type:</p>
<div class="fragment"><div class="line">make</div>
<div class="line">./launchCARLsimECJ.sh</div>
</div><!-- fragment --><p>The simulation should run to completion and output the best fitness each generation.</p>
<p>This results in an ECJ out.stat file that we talk about in the next section.</p>
<h1><a class="anchor" id="tut7s4_output_files"></a>
7.4 ECJ Output Files</h1>
<p>The output.stat file generated contains the best fitness for that generation along with the four parameter values associated with that individual. <a class="el" href="namespaceCARLsim.html">CARLsim</a> users can then use these parameters for their tuned <a class="el" href="classSNN.html" title="Contains all of CARLsim&#39;s core functionality. ">SNN</a> models.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="ch10_ecj.html">Chapter 10: ECJ</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Apr 12 2018 18:34:26 for CARLsim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
